import os
import json
import asyncio
import aiohttp
import logging
from datetime import datetime

# Configuration
TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN', '')
TELEGRAM_CHAT_ID = os.environ.get('TELEGRAM_CHAT_ID', '')
STEAM_API_KEY = os.environ.get('STEAM_API_KEY', '')

# Steam account IDs to monitor (just the IDs, no names needed)
STEAM_ACCOUNTS = [

    '76561199419974482','76561199419826279','76561199417084914','76561199418920757','76561199419563010','76561199421686380',
'76561199419283384','76561199418299551','76561199421318189','76561199417820671','76561199418583570','76561199417754944',
'76561199417530112','76561199421070476','76561199421523180','76561199417432876','76561199419488186','76561199417585806',
'76561199417828327','76561199417136051','76561199418100259','76561199417379746','76561199404993037','76561199417973470',
'76561199419797599','76561199418774971','76561199418283519','76561199416284440','76561199417737492','76561199419708853',
'76561199416376993','76561199404798636','76561199420703557','76561199418181754','76561199417967550','76561199419147270',
'76561199095194757','76561199418968614','76561199418798017','76561199417970271','76561199418992618','76561199418224499',
'76561199418527815','76561199417197848','76561199418018063','76561199418125678','76561199418806652','76561199260337032',
'76561199417090609','76561199418409042','76561199419488737','76561199420772063','76561198991363806','76561199421609830',
'76561199260337032','76561199417090609','76561199418209806','76561199421710492','76561199406993150','76561199418805821',
'76561199418077126','76561199417376797','76561199404363609','76561199432804736','76561199245787628','76561199404837773',
'76561199392777472','76561199406471752','76561199404651292','76561199268048714','76561199405105612','76561198991662660',
'76561199410759723','76561199429442317','76561199434424768','76561199484877207','76561199261772657','76561199484853590',
'76561199241207978','76561199249423778','76561199385167384','76561199439026842','76561199261733690','76561198991446547',
'76561199407345842','76561199261941871','76561199405108913','76561199410465050','76561199193329390','76561199433220007',
'76561198991364093','76561199499558153','76561199418172150','76561199407327748','76561199242299509','76561199405322672',
'76561199407409310','76561199433503568','76561199255927009','76561199255931499','76561199252678355','76561199257878567',
'76561199255860408','76561199257698927','76561199253050816','76561199419999034','76561199419663194','76561199416971707',
'76561198991228333','76561198991269830','76561198991695591','76561199484410240','76561198991426094','76561199485000500',
'76561198991796171','76561199433260750','76561198991343378','76561198991492178','76561198991659861','76561198991894506',
'76561198991140759','76561198991589324','76561199434466087','76561199434294992','76561198991730402','76561198991468171',
'76561199484667083','76561199484930730','76561198113406999','76561198991498809','76561199410395626','76561199417042444',
'76561199187490367','76561199412469571','76561199405257331','76561199405322672','76561199407409310','76561199433503568',
'76561198991364093','76561199499558153','76561199241207978','76561199484853590','76561199405248609','76561199434289094',
'76561199431976764','76561199410818261','76561199484871427','76561199410444251','76561199484715157','76561199410731794',
'76561198991465339','76561199432802925','76561199255121940','76561199253836867','76561199256353229','76561199255860408',
'76561199253050816','76561199253710340','76561199252637646','76561199418387376','76561199417869091','76561199418289284',
'76561199244791183','76561199439616207','76561199407099436','76561199404916553','76561199438808651','76561199188677611',
'76561199405450989','76561199214628114','76561198991357918','76561199441231091','76561199417858365','76561199404999870',
'76561199244769482','76561199485046452','76561199433594956','76561199407799608','76561198991295971','76561199268021809',
'76561199240959513','76561199407543356','76561199404501748','76561199407013743','76561199405197254','76561199407443223',
'76561199214492317','76561199394087735','76561199405242082','76561199260078491','76561199393206890','76561199262399234',
'76561199432802925','76561199431452354','76561199410395115','76561199484761902','76561199253801746','76561199253046981',
'76561199254455753','76561199255713767','76561199258317031','76561199250348862','76561199253968316','76561199252957637',
'76561199253191699','76561199253887110','76561199256274904','76561199252446776','76561199255365229','76561199255951935',
'76561199256223243','76561199256136773','76561199253996597','76561199420711258','76561199418380196','76561199417422486',
'76561199404944540','76561199214644001','76561199410689817','76561199434432821','76561199485334223','76561199417709836',
'76561199484609792','76561199403050471','76561199407370996','76561199410738065','76561199242280120','76561199404803133',
'76561199410406067','76561199404752595','76561199433131505','76561199189491787','76561199410434129','76561199405182243',
'76561199410706892','76561199485494348','76561199405061170','76561199417742423','76561199407398037','76561199407358604',
'76561199410581939','76561199484836742','76561199393731325','76561199410767006','76561199240882760','76561199187630615',
'76561199404806812','76561198991696328','76561199433757483','76561199407458533','76561199385167384','76561199407195803',
'76561199440002291','76561199410629375','76561199405090685','76561199431859158','76561199410499056','76561199254114775',
'76561199252863697','76561199256411132','76561199258822092','76561199253855323','76561199252881882','76561199252859637',
'76561199252678355','76561199253460826','76561199256348194','76561199417554069','76561199417860648','76561199417315978',
'76561199404921506','76561199484745772','76561199485344894','76561199249423778','76561199404713793','76561199432162246',
'76561199433220007','76561199245787628','76561199405108913','76561199410465050','76561199392777472','76561199406471752',
'76561199261941871','76561199268048714','76561199261772657','76561199404837773','76561199404651292','76561199405105612',
'76561198991446547','76561199429442317','76561199439026842','76561199261733690','76561199407345842','76561199418172150',
'76561199193329390','76561199407327748','76561199242299509','76561199484564195','76561198991608290','76561198991662660',
'76561199410759723','76561199407443223','76561199260078491','76561198991364774','76561199433132399','76561199485446674',
'76561199407460156','76561199417837952','76561199412343935','76561199484411768','76561199484790268','76561199254456869',
'76561199253198877','76561199257698927','76561199255927009','76561199255931499','76561199257878567','76561199255880574',
'76561199256302430','76561199253956655','76561199253977057','76561199390972847','76561199417401875',
'76561199484860554','76561199407012019','76561199484831071','76561199484848295','76561199404851932','76561199410820048',
'76561199261984937','76561199365310353','76561199404788717','76561199410483508','76561199094938841','76561199484981345',
'76561198991650354','76561199432944565','76561199242399478','76561199485437707','76561199485137097','76561199485013625',
'76561199434292365','76561199410707908','76561199484523613','76561199404691990','76561199405080377','76561199410658324',
'76561199405303070','76561199405045348','76561199241088827','76561199410829177','76561199406231948','76561199241563536',
'76561198991866865','76561198991475705','76561199417194709','76561198991357918','76561199439616207','76561199407605191',
'76561199197739098','76561199442115229','76561199217291157','76561199410637328','76561199404501748','76561199407543356',
'76561199262399234','76561199254443117','76561199254704429','76561199253167910','76561199258317031','76561199255713767',
'76561199258541730','76561199253191699','76561199254741268','76561199255860408','76561199257878567','76561199255927009',
'76561199410592132','76561199407179152','76561199484866428','76561199241107114','76561199407786464','76561199407543356',
'76561199404501748','76561198991702767','76561199484790043','76561199484787031','76561199261688107','76561199404778816',
'76561199411071585','76561199417539072','76561198991756377','76561199410583302','76561199417979826','76561199260233927',
'76561199410426799','76561199404921379','76561199410590721','76561199417850681','76561199407462125','76561199406637801',
'76561199260764798','76561199417614724','76561199441075145','76561199418179324','76561199386854248','76561199484953832',
'76561199261884425','76561198991751754','76561199433797011','76561198991327374','76561199404599758','76561199439943006',
'76561199255949752','76561199253653883','76561199253371136','76561199254160855','76561199254440372','76561199253561303',
'76561199256152880','76561199255481876','76561199255407676','76561199257861046','76561199253139389','76561199254281009',
'76561199250266240','76561199253640271','76561199254718970',
'76561199485081810','76561199439572372','76561199410518532','76561199404975226','76561199407765668','76561199240724243',
'76561199404725410','76561199417490590','76561199405288109','76561199243577553','76561199260573984','76561198991708768',
'76561199407375982','76561198991658122','76561199485435610','76561199431626149','76561198991269830','76561199432804736',
'76561199485703436','76561199432221809','76561199485128975','76561199405000090','76561199260042970','76561199484728616',
'76561199438753264','76561198991895074','76561199212349604','76561199405046001','76561198991331460','76561199433112032',
'76561199432854815','76561199434036880','76561198991468171','76561198991475192','76561198991343378','76561199432947368',
'76561199484906344','76561199433260750','76561198991492178','76561199434466087','76561199253071136','76561199254017379',
'76561199255631819','76561199255430626','76561199256141330','76561199253314365','76561199253292821','76561199253309527',
'76561199253674273','76561199254198609','76561199252177463','76561198008017989','76561199444997164','76561198013308185',
'76561198991608290','76561199484411768','76561199245787628','76561199261733690','76561199249423778','76561199385167384',
'76561199417837952','76561199392777472','76561199406471752','76561198991364093','76561199407327748','76561199405257331',
'76561199405322672','76561199418172150','76561199499558153','76561199242299509','76561199404837773','76561199405105612',
'76561199268048714','76561199405108913','76561199410465050','76561198991662660','76561199410759723','76561198991446547',
'76561199404651292','76561199429442317','76561199261941871','76561199439026842','76561198991364774','76561199484853590',
'76561199484564195','76561199485446674','76561199433132399','76561199405248609','76561199241207978','76561199433220007',
'76561199404713793','76561199407345842','76561199193329390','76561199407409310','76561199433503568','76561199432162246',
'76561199252678355','76561199253460826','76561199255880574',
'76561199253710340','76561199253050816','76561199257698927',
'76561199412343935','76561199434917844','76561198991767015','76561199485487695','76561199434213762','76561198991228333',
'76561198991743002','76561198991300772','76561199484877207','76561199433321470','76561199405241645','76561199393112169',
'76561199431035200','76561199260657771','76561199417699282','76561199484982810','76561199485344894','76561198991514914',
'76561199261772657','76561199392324865','76561198991719997','76561198991561550','76561199434424768','76561199259843370',
'76561199261299408','76561199417451074','76561199433393057','76561199155089744','76561199262656369','76561198991473341',
'76561199433468511','76561199392511000','76561199431487801','76561199434289094','76561199260078491','76561199214492317',
'76561199404995760','76561199433219826','76561199407443223','76561198991295971','76561199433594956','76561199407799608',
'76561199485606092','76561199407013743','76561199405197254','76561199253726949','76561199255931499','76561199253620767',
'76561199256166917','76561199254214455','76561199253999262',
'76561199417539072','76561199417850681','76561198991756377','76561198991305624','76561199484866428','76561199241107114',
'76561199434275186','76561199410590721','76561199407462125','76561198991959810','76561199485046996','76561199406637801',
'76561199484790043','76561199410426799','76561199404599758','76561199187490804','76561199198809485','76561199260233927',
'76561199417412750','76561199404742134','76561199404921379','76561199216667128','76561199260764798','76561199417614724',
'76561199441075145','76561199484849252','76561199409937940','76561199407762187','76561199188153853','76561199484787031',
'76561199261688107','76561199404778816','76561199196034425','76561199241264167','76561199406112732','76561199404975226',
'76561199407765668','76561198991327374','76561199386854248','76561199484953832','76561199407786464','76561199255481876',
'76561199256429639','76561199255407676','76561199253640271','76561199256152880','76561199254201682','76561199255299057',
'76561199250266240','76561199252177463','76561199254281009',
'76561199261884425','76561198991751754','76561199405180054','76561199410737397','76561199161268247','76561199411071585',
'76561199417539072','76561199441075145','76561199410583302','76561198991327374','76561199410425877','76561199433797011',
'76561199418179324','76561199386854248','76561199484953832','76561199188153853','76561198991305624','76561199484866428',
'76561199241107114','76561199407786464','76561199407443223','76561199439616207','76561199433594956','76561199407799608',
'76561199268021809','76561199407013743','76561199405197254','76561198991357918','76561199441231091','76561199417858365',
'76561199161412650','76561199406671119','76561199394087735','76561199407434958','76561199407332053','76561199259064952',
'76561199254440372','76561199253729005','76561199253561303','76561199254829210','76561199253139389','76561199254281009',
'76561199257861046','76561199253999262','76561199253191699','76561199253887110','76561199256274904','76561199253968316',
'76561199252957637','76561199255946902','76561199252446776',
'76561199155316486','76561199386811927','76561199385257288','76561199407759598','76561199192572396','76561199404728960',
'76561199192643987','76561199407312641','76561198991658461','76561199484760616','76561199405070465','76561199404782980',
'76561199410745757','76561199485178682','76561199484607522','76561199214832826','76561199442453379','76561199405023819',
'76561199439280132','76561199260549863','76561199407688127','76561199276904861','76561198992064823','76561199404979974',
'76561199405307211','76561199407499574','76561199484955774','76561199245215947','76561199405005328','76561199365170396',
'76561199243965413','76561199404726206','76561199245082938','76561199393261443','76561199241337272','76561199485004301',
'76561199433167416','76561199485047294','76561199261610507','76561199407508098','76561199407346932','76561199439670796',
'76561199484926359','76561199253250824','76561199252368842','76561199254762504','76561199254034063','76561199254211624',
'76561199250363126','76561199253686090','76561199259162949',
'76561199187719052','76561199404983662','76561199485004301','76561199245082938','76561199393261443','76561199241337272',
'76561199405005328','76561199407508098','76561199407346932','76561199405307211','76561199404910099','76561199155316486',
'76561199386811927','76561199385257288','76561199392229050','76561199433295416','76561199260432290','76561199404525219',
'76561199485046229','76561199407823099','76561198991336055','76561199433167416','76561199243965413','76561199484607522',
'76561199406969808','76561199407420337','76561199485022824','76561199365170396','76561199404775998','76561199405465567',
'76561199240905927','76561199191726409','76561199417815554','76561199404943515','76561199485178682','76561199439280132',
'76561199198821432','76561199214832826','76561199442453379','76561199405023819','76561199407688127','76561199410745757',
'76561199407619231','76561199253401469','76561199257270723','76561199254246391','76561199259162949','76561199254211624',
'76561199250363126','76561199254034063','76561199253486015',
'76561198991336055','76561199410896257','76561199407823099','76561199417815554','76561199407584204','76561199433295416',
'76561199191726409','76561199267808655','76561199407180595','76561199410327880','76561199279611212','76561199407422953',
'76561199438411251','76561199407360643','76561198991471643','76561199155669929','76561199261776616','76561199441914781',
'76561199198151041','76561199404753138','76561199213961757','76561199404876937','76561199384279614','76561199407168052',
'76561199404729757','76561199410443018','76561199485104687','76561199484208860','76561199405040057','76561199438145940',
'76561199410497635','76561199392229050','76561199404943515','76561199260432290','76561199404525219','76561199485046229',
'76561199198821432','76561199404713009','76561199410692600','76561199404980969','76561199240905927','76561199433688023',
'76561199253390292','76561199253651467','76561199254062768','76561199254246391','76561199255999145','76561199257270723',
'76561199256031015','76561199255248658','76561199253524188',
'76561199385264891','76561199394229288','76561199407604637','76561199261891407','76561199261743702','76561199485343947',
'76561199407871271','76561199405098070','76561199404889966','76561199405108166','76561199407169075','76561199410470059',
'76561199189005878','76561199407159489','76561199187719052','76561199404983662','76561199197961133','76561199485908162',
'76561199398217085','76561199406965056','76561199406989819','76561199365470389','76561199404710337','76561199196336028',
'76561199485113971','76561199407581586','76561199485437326','76561199441619656','76561199371172926','76561199407386478',
'76561199393994696','76561199404806968','76561199431687114','76561199485102537','76561199254383899','76561199255886991',
'76561199255863540','76561199253059597','76561199257648742','76561199251890048','76561199257537284','76561199255458904',
'76561199252970232','76561199254497178','76561199252868025','76561199254312870','76561199251941360','76561199253924933',
'76561199255459044','76561199253162032','76561199253709812',
'76561199404962192','76561199410568792','76561198991604091','76561199404677925','76561199189330996','76561199407237208',
'76561199439771597','76561199406965056','76561199406989819','76561199485204924','76561199404713237','76561199196336028',
'76561199410889525','76561199485437326','76561199441619656','76561199371172926','76561199485113971','76561199407581586',
'76561199214834021','76561199195943490','76561199162436836','76561199440124072','76561199431687114','76561199485102537',
'76561199267896257','76561199189172758','76561199485293261','76561199485035598','76561199195563906','76561199405061601',
'76561199410462987','76561199439900371','76561199407335785','76561199190229572','76561199407591536','76561199485130281',
'76561199217372488','76561199393416653','76561199256562947','76561199257675643','76561199252994673','76561199252868025',
'76561199254497178','76561199255910985','76561199253924933','76561199253709812','76561199255768308','76561199256468305',
'76561199256506062','76561199252990124','76561199252846028',
'76561199485036684','76561199385060247','76561199189779210','76561199407510820','76561199191926975','76561199198823980',
'76561199484653574','76561199440178768','76561199406969808','76561199407613513','76561199406954656','76561198010404714',
'76561198013950504','76561198014083277','76561198016840835','76561198009251509','76561199446072121','76561199445046978',
'76561199444494476','76561198015986023','76561199445086148','76561198017874606','76561198008066185','76561198008250828',
'76561198010793236','76561199445053075','76561198005692611','76561198009972786','76561198016072169','76561198013946776',
'76561199444773349','76561199444997333','76561198005894298','76561199444692091','76561199444517316','76561199444882704',
'76561199444549330','76561198016511167','76561198017176688','76561198016207831','76561198019024104','76561198015321100',
'76561199256134351','76561199256660907','76561199255752557','76561199255685253','76561199252985795','76561199255841661',
'76561199253046981','76561199255639332','76561199252863697','76561199444715116','76561198011846461','76561198014135016',
'76561198004746436','76561198007401131','76561198015704306','76561198009649301','76561198008045386','76561198015801460',
'76561198009845603','76561198019012633','76561198017494087','76561198014302729','76561198009116799','76561198008835555',
'76561198010321789','76561198014197783','76561199445064737','76561199434863556','76561198014263833','76561198014647864',
'76561198007229463','76561198013950504','76561198010404714','76561198011878777','76561198010947053','76561198013429228',
'76561199445086148','76561198006441392','76561198010833622','76561198012823983','76561199444381410','76561198015615557',
'76561199444087193','76561199444218287','76561198009799163','76561198014398052','76561198015986023','76561198013008896',
'76561199443180410','76561199445336066','76561198008066185','76561198008250828','76561198010793236','76561198014083277',
'76561199444511391','76561198017176688','76561198009251509','76561198017126602','76561198017874606','76561198016207831',
'76561198016511167','76561199444549330','76561198005505855','76561199276756407',
'76561199444494476','76561199444773349','76561199444882704','76561198005692611','76561198016072169','76561198009972786',
'76561199444997333','76561198013946776','76561199444796906','76561198006379785','76561199444998367','76561198017210455',
'76561198015321100','76561198004921551','76561198005116367','76561198019024104','76561198007694232','76561199445092652',
'76561198016840835','76561199444686498','76561199446072121','76561199445046978','76561199261044014','76561199444315918',
'76561199247089183','76561199444834394','76561198010767371','76561198013750725','76561199445245311','76561199444869672',
'76561198007978137','76561198009292995','76561199435956844','76561198014074511','76561198012042890','76561199444407464',
'76561198012717502','76561199445417535','76561199445568455','76561198010646886','76561198010378217','76561199445151945',
'76561199444632478','76561199444763962','76561199277698045','76561199444959960','76561198006409286','76561198013582551',
'76561199443478521','76561198017160744','76561198007995399','76561198008931634',
'76561199444880782','76561198013657766','76561199444515311','76561199444633545','76561199444923379','76561199277971410',
'76561199444615072','76561199444620628','76561199444916554','76561198005698629','76561199444674757','76561199445008003',
'76561198012969599','76561199445865493','76561198005299542','76561199445163330','76561199444567817','76561199445081399',
'76561199445013606','76561198016897829','76561199442650556','76561199444912186','76561199444612239','76561199445023370',
'76561199444787832','76561199444665233','76561199444426629','76561198008157605','76561199444763847','76561198016429979',
'76561199444869108','76561198016073433','76561198006288610','76561198005894298','76561198008104224','76561198005406282',
'76561198007970327','76561199444517316','76561199444692091','76561199444297029','76561199279656986','76561199386394393',
'76561199268037459','76561199444407810','76561198017850826','76561198005306330','76561199444924369','76561199444380974',
'76561199444928861','76561198013612788','76561199444382344','76561199444038751',
'76561198013612788','76561199277698045','76561199445568455','76561199444744998','76561198007713658','76561198006482043',
'76561198008208719','76561199275103203','76561199371209730','76561199444909558','76561199445249333','76561199445188551',
'76561199444091635','76561198008582618','76561198007737431','76561199444818302','76561199444804524','76561199444641071',
'76561199444987815','76561199445361603','76561198011244218','76561199445019435','76561198014166770','76561199339097691',
'76561199444696057','76561199444837028','76561199444876982','76561199444937279','76561199444763962','76561199444632478',
'76561198010835847','76561198015089543','76561199361940597','76561198008813954','76561199444512536','76561198012397404',
'76561198009849424','76561199444795299','76561199445352737','76561199444558076','76561198016881389','76561199444976000',
'76561198010378217','76561199445151945','76561198011203767','76561199444136416','76561199445082241','76561199444915024',
'76561199444624434','76561198011086887','76561198009653245','76561198006015413',
'76561198011150147','76561199444765322','76561199445172819','76561199444864066','76561198007007383','76561198012717502',
'76561199444407464','76561198010646886','76561199444425288','76561199444396690','76561198007539004','76561199444736442',
'76561199445417535','76561198014771091','76561199444552147','76561199444711880','76561198015051725','76561199444932381',
'76561199444893572','76561198004825232','76561199445198462','76561199444633454','76561199444628640','76561199445335977',
'76561199498972351','76561199498412157','76561199499030985','76561199498702992','76561199499021972','76561199498806581',
'76561199498440910','76561199499046632','76561197999749945','76561199499151649','76561199498823282','76561199499188621',
'76561197998047330','76561199498770372','76561199499159589','76561199499045986','76561199498433276','76561198000555815',
'76561199498675817','76561197998581881','76561197999972753','76561199498725642','76561197983372988','76561198086963040',
'76561198008915276','76561198843845497','76561197992885725','76561198040182689','76561199416161784','76561199159594157',
'76561199007455340','76561198909894936','76561198068577804',
'76561197998958187','76561198000323023','76561199498942172','76561199499051442','76561199498770372','76561197998047330',
'76561198002018067','76561198001372450','76561198000534579','76561199498569554','76561199499069282','76561199499470437',
'76561198000950524','76561199499063096','76561199499046270','76561198001848565','76561199499159589','76561199499060277',
'76561199499188621','76561199499140418','76561197999019260','76561199498869115','76561199498908313','76561198000987570',
'76561199498675817','76561199499045986','76561199498823282','76561198000555815','76561199499151649','76561197998581881',
'76561197999972753','76561199498725642','76561199499034061','76561198001281332','76561198003444959','76561198002497438',
'76561199498780980','76561199498967557','76561197999665535','76561198000791857','76561199499131498','76561198003037354',
'76561199498889178','76561199499501691','76561199499600526','76561199498835179','76561199498737702','76561198002575499',
'76561197998149680','76561198000053727','76561199499572701',
'76561199498541070','76561197999030036','76561198001620474','76561198002451093','76561199498396837','76561198000964818',
'76561199499289383','76561199498602604','76561198001284185','76561197999506376','76561199498705485','76561199499201463',
'76561199499181242','76561199498995758','76561199498993859','76561199498469373','76561198000350133','76561197998720131',
'76561199498800829','76561198001376841','76561198002123634','76561198002233430','76561199498379050','76561199499537959',
'76561199499405447','76561199498661117','76561198001822146','76561199499096178','76561199498775689','76561199499162824',
'76561198003531482','76561197999952961','76561199498729725','76561198001433851','76561199498824134','76561198001348402',
'76561199498829396','76561199499217579','76561197998160162','76561199498927642','76561197999934939','76561198003070653',
'76561198002230223','76561199499285613','76561199499128782','76561199498714779','76561198994916396',
'76561198018316075','76561198004532702','76561198004961490','76561198005605942','76561198017563686','76561198014872053',
'76561198009902450','76561198015339546','76561198004701039','76561198015102598','76561198016184071','76561198012402573',
'76561198012313709','76561198007786697','76561198016728953','76561198018151036','76561198009246762','76561198003968314',
'76561198017168154','76561198022196454','76561198010825512','76561198010774018','76561198006528782','76561198015340439',
'76561198021201697','76561198006123569','76561198012656665','76561198008801039','76561198017792776','76561198006015261',
'76561198022265282','76561198009707050','76561198016140936','76561198007007337','76561198008503722','76561198008623453',
'76561198012546228','76561198005359714','76561198015024404','76561198016086057','76561198015246726','76561198004512690',
'76561198009735479','76561198004851605','76561198004731130','76561198019571023','76561198010330854','76561198019932068',
'76561198014648584','76561198007319086','76561198020619890',
'76561198022265282','76561198012546228','76561198008623453','76561198016140936','76561198007167477','76561198008503722',
'76561198013046173','76561198016186531','76561198007077479','76561198022158193','76561198018873666','76561198021063819',
'76561198013993883','76561198012012073','76561198011318908','76561198020544677','76561198014351072','76561198008749235',
'76561198014499996','76561198013561217','76561198008411042','76561198014271631','76561198034819202','76561198021128388',
'76561198010467240','76561198004977241','76561198005599287','76561198009253147','76561198019549430','76561198019438449',
'76561198006281682','76561198022681410','76561198012003370','76561198026138966','76561198017345306','76561198007859804',
'76561198012279967','76561198017351625','76561198016912600','76561198022628202','76561198013668951','76561198022313759',
'76561198029868215','76561198021864620','76561198013281095','76561198017428302','76561198004818549','76561198026707735',
'76561198008518657','76561198009120127','76561198022536437',
'76561198021603026','76561198006839711','76561198018340246','76561198005186195','76561198018851685','76561198021635215',
'76561198012773104','76561198018038430','76561198010554384','76561198018210110','76561198010264788','76561198006760553',
'76561198017441932','76561198018813351','76561198016880244','76561198014505703','76561198013307918','76561198016665526',
'76561198015029487','76561198022299042','76561198015283484','76561198014788263','76561198003794641','76561198019974214',
'76561198016403063','76561198006102275','76561198011626627','76561198021877028','76561198011811981','76561198006319298',
'76561198021977063','76561198014420754','76561198017937581',
    
]
    
    
DATA_FILE = 'friend_data.json'
INIT_FILE = '.initialized'

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger("SteamFriendIDMonitor")

def get_profile_link(steam_id):
    """Generate Steam profile link from Steam ID"""
    return f"steamcommunity.com/profiles/{steam_id}"

async def fetch_friend_list(session, steam_id):
    """Fetch the complete friend list for a Steam account"""
    url = f"http://api.steampowered.com/ISteamUser/GetFriendList/v0001/?key={STEAM_API_KEY}&steamid={steam_id}&relationship=friend"
    profile_link = get_profile_link(steam_id)
    
    try:
        async with session.get(url, timeout=10) as resp:
            if resp.status == 200:
                data = await resp.json()
                friends_data = data.get('friendslist', {}).get('friends', [])
                # Extract just the Steam IDs of friends
                friend_ids = [friend['steamid'] for friend in friends_data]
                return steam_id, profile_link, friend_ids
            elif resp.status == 403:
                logger.warning(f"{profile_link} is private")
                return steam_id, profile_link, None
            else:
                logger.error(f"{profile_link}: API error {resp.status}")
                return steam_id, profile_link, None
    except Exception as e:
        logger.error(f"Error fetching {profile_link}: {e}")
        return steam_id, profile_link, None

async def send_telegram_message(message):
    """Send message to Telegram, splitting if too long"""
    MAX_MESSAGE_LENGTH = 4000  # Leave some buffer under 4096 limit
    
    if len(message) <= MAX_MESSAGE_LENGTH:
        await _send_single_message(message)
    else:
        # Split message into chunks
        lines = message.split('\n')
        current_chunk = ""
        
        for line in lines:
            # If adding this line would exceed limit, send current chunk
            if len(current_chunk + line + '\n') > MAX_MESSAGE_LENGTH:
                if current_chunk:
                    await _send_single_message(current_chunk.strip())
                    current_chunk = line + '\n'
                else:
                    # Single line is too long, truncate it
                    await _send_single_message(line[:MAX_MESSAGE_LENGTH])
            else:
                current_chunk += line + '\n'
        
        # Send remaining chunk
        if current_chunk:
            await _send_single_message(current_chunk.strip())

async def _send_single_message(message):
    """Send a single message to Telegram"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': message,
        'parse_mode': 'HTML'
    }
    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(url, data=payload) as resp:
                if resp.status != 200:
                    logger.error(f"Failed to send message: {await resp.text()}")
                else:
                    logger.info("Telegram message sent successfully")
        except Exception as e:
            logger.error(f"Telegram error: {e}")

def load_previous_data():
    """Load previous friend data from file"""
    try:
        with open(DATA_FILE, 'r') as f:
            return json.load(f)
    except:
        return {}

def save_data(data):
    """Save friend data to file"""
    with open(DATA_FILE, 'w') as f:
        json.dump(data, f, indent=2)

def is_first_run():
    """Check if this is the first run of the bot"""
    if os.path.exists(INIT_FILE):
        return False
    with open(INIT_FILE, 'w') as f:
        f.write(datetime.now().isoformat())
    return True

async def check_accounts():
    """Main function to check all accounts for friend changes"""
    first_run = is_first_run()
    previous_data = load_previous_data()
    current_data = {}
    all_new_friends = []
    
    async with aiohttp.ClientSession() as session:
        results = []
        BATCH_SIZE = 500  # Process 100 accounts at a time
        DELAY_BETWEEN_BATCHES = 5  # Wait 5 seconds between batches
        
        for i in range(0, len(STEAM_ACCOUNTS), BATCH_SIZE):
            batch = STEAM_ACCOUNTS[i:i + BATCH_SIZE]
            tasks = [fetch_friend_list(session, steam_id) for steam_id in batch]
            batch_results = await asyncio.gather(*tasks)
            results.extend(batch_results)
            
            # Don't delay after the last batch
            if i + BATCH_SIZE < len(STEAM_ACCOUNTS):
                logger.info(f"Processed {i + BATCH_SIZE}/{len(STEAM_ACCOUNTS)} accounts, waiting {DELAY_BETWEEN_BATCHES}s...")
                await asyncio.sleep(DELAY_BETWEEN_BATCHES)
    
    for steam_id, profile_link, friend_ids in results:
        if friend_ids is None:
            continue
            
        current_data[steam_id] = {
            'profile_link': profile_link,
            'friends': friend_ids,
            'count': len(friend_ids)
        }
        
        # Skip change detection on first run
        if first_run or steam_id not in previous_data:
            continue
            
        previous_friends = set(previous_data[steam_id].get('friends', []))
        current_friends = set(friend_ids)
        
        # Check for new friends only
        new_friends = current_friends - previous_friends
        if new_friends:
            for friend_id in new_friends:
                friend_profile_link = get_profile_link(friend_id)
                all_new_friends.append(friend_profile_link)
                logger.info(f"New friend detected: {friend_id} added to {steam_id}")
        
        # Log removed friends (no telegram notification)
        removed_friends = previous_friends - current_friends
        if removed_friends:
            for friend_id in removed_friends:
                logger.info(f"Friend removed: {friend_id} removed from {steam_id}")

    # Send batched notification for all new friends
    logger.info(f"Total new friends collected: {len(all_new_friends)}")
    logger.info(f"First run status: {first_run}")
    
    if all_new_friends and not first_run:
        if len(all_new_friends) == 1:
            msg = f"New friend: {all_new_friends[0]}"
        else:
            msg = f"New friends detected ({len(all_new_friends)}):\n\n"
            msg += "\n".join([f"â€¢ {friend_link}" for friend_link in all_new_friends])
        
        logger.info(f"Attempting to send Telegram message: {msg[:100]}...")
        await send_telegram_message(msg)
        logger.info(f"Sent batched notification for {len(all_new_friends)} new friends")
    elif all_new_friends and first_run:
        logger.info(f"New friends detected on first run (not sending notification): {len(all_new_friends)}")
    else:
        logger.info("No new friends detected in this cycle")

    # Save current data
    save_data(current_data)

    if first_run:
        # Log initial setup (no telegram messages)
        total_accounts = len(current_data)
        private_accounts = len(STEAM_ACCOUNTS) - total_accounts
        total_friends = sum(data['count'] for data in current_data.values())
        
        logger.info(f"Steam Friend ID Monitor Setup Complete")
        logger.info(f"Monitoring {total_accounts} accounts")
        logger.info(f"Total friends being tracked: {total_friends}")
        if private_accounts > 0:
            logger.info(f"{private_accounts} accounts are private")
        logger.info("Bot will now notify when specific friends are added with their Steam IDs")
    else:
        logger.info("Friend check completed")

if __name__ == '__main__':
    asyncio.run(check_accounts())
