import os
import json
import asyncio
import aiohttp
import logging
from datetime import datetime

# Configuration
TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN', '')
TELEGRAM_CHAT_ID = os.environ.get('TELEGRAM_CHAT_ID', '')
STEAM_API_KEY = os.environ.get('STEAM_API_KEY', '')

# Steam account IDs to monitor (just the IDs, no names needed)
STEAM_ACCOUNTS = [
    
  '76561198002459076','76561198002814994','76561198002931610','76561198003044105','76561198003576542','76561198004805385',
'76561198005912702','76561198005999650','76561198006034833','76561198006367911','76561198009188599','76561198010370267',
'76561198011218548','76561198011678928','76561198012175452','76561198013598292','76561198013615882','76561198014135072',
'76561198016996825','76561198017222642','76561198019895271','76561198021809052','76561199827182298','76561199827236395',
'76561199827609737','76561199827909162','76561199827971633','76561199827978508','76561199828111092','76561199828490556',
'76561199828510697','76561199828575254','76561199828600807','76561199828873502','76561197990330875','76561197990545286',
'76561197991033524','76561197991511405','76561197991643260','76561197992198029','76561197992766143','76561197992788717',
'76561197993063936','76561197994652263','76561197994817319','76561197995660731','76561197995779615','76561197996390423',
'76561197997538286','76561197998637652','76561197998665444',
'76561197999363122','76561197999785281','76561198000195065','76561198000891412','76561198001365732','76561198001491647',
'76561198002877057','76561198003438409','76561198003767635','76561198004597539','76561198007380053','76561198007872748',
'76561198008301969','76561198011455098','76561198012857228','76561198012999234','76561198013143045','76561198013246551',
'76561198014392702','76561198015473371','76561198017187811','76561198017468047','76561198017848098','76561198018109488',
'76561198018374462','76561198019039895','76561198020956106','76561198023265169','76561198023795806','76561199826687554',
'76561199826936608','76561199827152854','76561199827215374','76561199827515705','76561199827644894','76561199827774449',
'76561199828130325','76561199828280472','76561199828312286','76561199828375077','76561199828480135','76561197989810823',
'76561197991725041','76561197993110200','76561197993333083','76561197993626623','76561197993840193','76561197994008402',
'76561197995185692','76561197996409457','76561197996503673',
'76561197997301575','76561197997702902','76561197998788578','76561197999123729','76561198000187186','76561198000900670',
'76561198001812428','76561198003820677','76561198003923750','76561198004623236','76561198013564878','76561198014160193',
'76561198015482503','76561198015768994','76561198016583602','76561198024012033','76561199827071982','76561199827111405',
'76561199827166540','76561199827246584','76561199827613170','76561199827692753','76561199827890494','76561199828281298',
'76561199828284282','76561199828429708','76561199828442326','76561199828505403','76561199828534692','76561199828834547',
'76561197989002350','76561197989520345','76561197990517865','76561197990683799','76561197990943244','76561197991678275',
'76561197992469671','76561197992485147','76561197993399102','76561197993782743','76561197994399633','76561197995279966',
'76561197995721351','76561197995940465','76561197996244744','76561197996963364','76561197997877272','76561197998566553',
'76561197998882520','76561197999204551','76561198886020013',
'76561197999559838','76561197999813670','76561198000066534','76561198000256220','76561198001372474','76561198002095700',
'76561198002453296','76561198002801111','76561198004629645','76561198004713083','76561198006393498','76561198007503520',
'76561198007943808','76561198007951319','76561198008496002','76561198011501645','76561198012919357','76561198014918618',
'76561198016386321','76561198016818612','76561198017373226','76561198018267549','76561198018868871','76561198020753539',
'76561199826899068','76561199827126363','76561199827267940','76561199827303721','76561199827329337','76561199827372901',
'76561199827433514','76561199827607060','76561199827623410','76561199827624400','76561199827668059','76561199827737305',
'76561199828050470','76561199828161582','76561199828203060','76561199828219852','76561199828284105','76561199828385595',
'76561199828448699','76561199828489756','76561199828531928','76561197991410271','76561197991671213','76561197992273780',
'76561197992444625','76561197992583495','76561197993485850',
'76561197993662838','76561197994583715','76561197994897149','76561197995197087','76561197995555409','76561197995621352',
'76561197996531792','76561197996533380','76561197996616696','76561197997920055','76561197999138353','76561197999200727',
'76561197999570776','76561198000074277','76561198000134947','76561198000412759','76561198001025965','76561198002819912',
'76561198003234354','76561198003896590','76561198004216317','76561198006693993','76561198007101834','76561198008214903',
'76561198009099488','76561198009964931','76561198012463730','76561198012795672','76561198013694203','76561198014505097',
'76561198015039552','76561198015154051','76561198016975761','76561198019133503','76561198021137745','76561198024752010',
'76561199827166351','76561199827343919','76561199827422865','76561199827473482','76561199827484252','76561199827602017',
'76561199827628728','76561199827678823','76561199828061279','76561199828073555','76561199828134856','76561199828180937',
'76561199828442604','76561199828456770','76561199828606717',
'76561199828739113','76561199828795068','76561199828813788','76561197991545137','76561197992134125','76561197992557391',
'76561197993240740','76561197993313243','76561197994330999','76561197995046990','76561197995876783','76561197996178209',
'76561197996521772','76561197996849001','76561197997001787','76561197998337823','76561197998977066','76561197999821335',
'76561198000772916','76561198001082568','76561198001146848','76561198001418383','76561198001676416','76561198002322774',
'76561198003161216','76561198003218747','76561198003225817','76561198003307816','76561198003459597','76561198003805796',
'76561198004026681','76561198004850223','76561198005401482','76561198007115220','76561198007142301','76561198007253583',
'76561198007536035','76561198009169253','76561198010693467','76561198012263983','76561198012844908','76561198013851035',
'76561198013884162','76561198014849776','76561198015025939','76561198022604141','76561199827144896','76561199827206460',
'76561199827240758','76561199827422973','76561199827818919',
'76561199827857310','76561199827974465','76561199828073437','76561199828150743','76561199828159567','76561199828232808',
'76561199828480031','76561199828508685','76561199828563318','76561199828601717','76561199828766697','76561199829200597',
'76561197988189611','76561197991529725','76561197991617165','76561197991679498','76561197992549673','76561197992654728',
'76561197995104009','76561197999543619','76561197999901613','76561198000413568','76561198003737190','76561198003926742',
'76561198004134047','76561198005194242','76561198005694671','76561198006048841','76561198007279755','76561198008722722',
'76561198008735015','76561198009277430','76561198010947109','76561198011051432','76561198011413704','76561198012333613',
'76561198012707332','76561198012826892','76561198012999241','76561198014784724','76561198015291073','76561198015346139',
'76561198016062125','76561198016144070','76561198016181896','76561198017510812','76561198018660705','76561198020398410',
'76561198023589811','76561198024025102','76561198832351194',
'76561199827543295','76561199827574052','76561199827725758','76561199827853428','76561199827922000','76561199827961890',
'76561199828143704','76561199828162546','76561199828295900','76561199828483048','76561199828512968','76561197989771830',
'76561197990259443','76561197991689328','76561197991937191','76561197992229792','76561197992454433','76561197992654657',
'76561197992733904','76561197992806743','76561197993629519','76561197995086097','76561197995825807','76561197997718232',
'76561197998276187','76561197998541332','76561197999398181','76561197999543499','76561197999666263','76561198000061514',
'76561198000095382','76561198001036780','76561198001498878','76561198002574523','76561198003148406','76561198003532396',
'76561198003868653','76561198003957237','76561198004012097','76561198004178335','76561198004214121','76561198005641603',
'76561198005842777','76561198006423811','76561198007862061','76561198008186516','76561198008354204','76561198008894249',
'76561198010177060','76561198010998591','76561198011425369',
'76561198013368428','76561198014374678','76561198014776540','76561198016274187','76561198016466402','76561198017495199',
'76561198018343952','76561198018768399','76561198020007834','76561199827326125','76561199827442315','76561199827749300',
'76561199827758021','76561199827885619','76561199828028361','76561199828085985','76561199828163530','76561199828292432',
'76561199828444481','76561199828507584','76561197988584575','76561197989120643','76561197991327643','76561197991526355',
'76561197991673880','76561197991728029','76561197993220674','76561197993227306','76561197996716510','76561197997154959',
'76561197997853238','76561197998225194','76561197998463601','76561197998849438','76561197999726788','76561198000243255',
'76561198000593283','76561198001785922','76561198002411122','76561198003124831','76561198003370639','76561198003727628',
'76561198003935854','76561198004191633','76561198004739811','76561198004868880','76561198005284017','76561198007466260',
'76561198007658768','76561198008336921','76561198129067927',
'76561198008991965','76561198009978805','76561198010308601','76561198010906834','76561198011678923','76561198011805718',
'76561198012594017','76561198014948266','76561198015916635','76561198016578174','76561198024170857','76561199827421947',
'76561199827579767','76561199827811564','76561199828113540','76561199828174126','76561199828201464','76561199828690785',
'76561197989561919','76561197991353308','76561197991740217','76561197991742892','76561197993441224','76561197993627571',
'76561197993982678','76561197994277619','76561197994304416','76561197994714617','76561197995036351','76561197995276071',
'76561197995815178','76561197996145064','76561197998525692','76561197998548551','76561197998568090','76561197999004194',
'76561197999193301','76561198000893012','76561198001180588','76561198001376757','76561198001859966','76561198002416727',
'76561198002499560','76561198004795062','76561198007826856','76561198009609186','76561198010122077','76561198010310996',
'76561198013144392','76561198014991073','76561198015743753',
'76561198015877207','76561198016469813','76561198019072226','76561199827271406','76561199827307479','76561199827387500',
'76561199827453558','76561199827782398','76561199827849638','76561199827942590','76561199827948270','76561199828141426',
'76561199828193436','76561199828206077','76561199828255585','76561199828575809','76561199828692059','76561197988727181',
'76561197989603271','76561197989931184','76561197990446870','76561197991976788','76561197992369815','76561197993816429',
'76561197994296085','76561197994359311','76561197994396459','76561197995576695','76561197995758601','76561197995974073',
'76561197996403344','76561197996948748','76561197999074402','76561197999728791','76561198000147530','76561198001816106',
'76561198002879022','76561198003252947','76561198003515395','76561198004462454','76561198004774049','76561198004804828',
'76561198005447888','76561198006162028','76561198008222825','76561198009830774','76561198009869693','76561198010491299',
'76561198012415968','76561198012989770','76561198013160599',
'76561198013571487','76561198014679188','76561198015253784','76561198015999231','76561198016514389','76561198017206757',
'76561198018504530','76561198019333901','76561198019544694','76561199827231965','76561199827317664','76561199827456288',
'76561199827490557','76561199827545630','76561199827617495','76561199827720091','76561199827780302','76561199827878686',
'76561199827911260','76561199828096305','76561199828199171','76561199828220309','76561199828248165','76561199828612830',
'76561199828732921','76561199828778015','76561197987888417','76561197988593470','76561197989689348',
'76561197989969891','76561197991352892','76561197992109396','76561197993136943','76561197993726496','76561197993932500',
'76561197994411831','76561197995116721','76561197996052823','76561197996868665','76561197997411656','76561197999781510',
'76561198000552086','76561198002121513','76561198002383797','76561198002427097','76561198004243751','76561198006286793',
'76561198007984237','76561198009291134','76561198011237376',
'76561198011314315','76561198012263872','76561198012432730','76561198012448721','76561198014230223','76561198015291103',
'76561198015335601','76561198015775219','76561198016090807','76561198016254141','76561198016586064','76561198020660118',
'76561199826983455','76561199827106325','76561199827316385','76561199827334238','76561199827416747','76561199827487666',
'76561199827548742','76561199827578217','76561199827679440','76561199827700634','76561199827732399','76561199827955570',
'76561199827959787','76561199828021176','76561199828168624','76561199828175334','76561199828184385','76561199828208528',
'76561199828261147','76561199828326747','76561199828576311','76561199828718922','76561199829141267','76561197988096780',
'76561197988114275','76561197991105719','76561197991114165','76561197991546533','76561197991569251','76561197992600489',
'76561197992713147','76561197992756043','76561197993418899','76561197993686034','76561197994104502','76561197994165504',
'76561197994554173','76561197994889169','76561197995232753',
'76561197995232753','76561197996725579','76561197996795865','76561197997319214','76561197998875926','76561197999518789',
'76561198000135441','76561198000425392','76561198000864350','76561198000990883','76561198001312763','76561198001464977',
'76561198002365819','76561198003598808','76561198003925280','76561198005029817','76561198005974774','76561198006092136',
'76561198010354935','76561198014627035','76561198014786633','76561198015494533','76561198016793096','76561198016856227',
'76561198017547348','76561198018012077','76561198019677494','76561198019880924','76561198023133932','76561198023215007',
'76561198023565543','76561198024133125','76561199827320961','76561199827479099','76561199827703383','76561199827940004',
'76561199827947952','76561199827956119','76561199827996898','76561199828070403','76561199828083228','76561199828177574',
'76561199828216155','76561199828245929','76561199828767878','76561199828802080','76561199829035607','76561199184500921',
'76561197987806239','76561197987882807','76561197989486993',
'76561197991260401','76561197991666677','76561197992124938','76561197992322801','76561197992600291','76561197993697526',
'76561197993703816','76561197993818059','76561197994603498','76561197996698705','76561197996940060','76561197998509762',
'76561197998965006','76561197998999903','76561197999072620','76561198000367671','76561198000951944','76561198001241577',
'76561198002045213','76561198002306679','76561198002508514','76561198002560675','76561198004865895','76561198004892452',
'76561198005431399','76561198006406948','76561198006598861','76561198007698506','76561198008193052','76561198009839031',
'76561198010127370','76561198010500152','76561198010590129','76561198011433239','76561198012484047','76561198014757554',
'76561198015288794','76561198017173075','76561198017829266','76561198018460702','76561198021067177','76561199827505672',
'76561199827633414','76561199827732543','76561199827819851','76561199827876209','76561199827998788','76561199828000991',
'76561199828176926','76561199828262110','76561199828338287',
'76561199828393978','76561199828399377','76561199828727982','76561197990448132','76561197992660668','76561197993973888',
'76561197996311205','76561197996352354','76561197996714968','76561197996758890','76561197997763830','76561197998543351',
'76561197998691266','76561197999429843','76561197999776966','76561198000257008','76561198000799712','76561198001121409',
'76561198002038936','76561198002397972','76561198002400261','76561198003185538','76561198003329081','76561198003533292',
'76561198004944873','76561198005538712','76561198005555495','76561198005999726','76561198006798691','76561198007038050',
'76561198007174102','76561198007730980','76561198011143693','76561198011595238','76561198011757362','76561198011841335',
'76561198012799618','76561198012856579','76561198013185085','76561198013520087','76561198013888895','76561198015474461',
'76561198016532828','76561198017412900','76561198020405428','76561198022043776','76561199827157833','76561199827172385',
'76561199827197019','76561199827303134','76561199827339963',
'76561199827562591','76561199827858619','76561199828047776','76561199828392695','76561199828734214','76561199828756319',
'76561199829110841','76561197987582794','76561197990395224','76561197990554923','76561197992992852','76561197993219300',
'76561197994089745','76561197994215685','76561197994541975','76561197996032666','76561197998323324','76561197998445734',
'76561197998698187','76561197998727464','76561198001018868','76561198001779786','76561198002233841','76561198002950928',
'76561198003637036','76561198004659153','76561198005522651','76561198008002889','76561198009203617','76561198010195867',
'76561198010874504','76561198012263252','76561198012370235','76561198012562387','76561198013071012','76561198014559676',
'76561198015844261','76561198016365246','76561198018137382','76561198018848053','76561198021163466','76561198021630185',
'76561198022965049','76561199826629886','76561199826954495','76561199827291409','76561199827331061','76561199827577262',
'76561199827661738','76561199827665540','76561199827765217',
'76561199827846436','76561199827964138','76561199828127888','76561199828182930','76561199828245579','76561199828287820',
'76561199828534731','76561199828732536','76561197987999665','76561197989090521','76561197990725442','76561197990929247',
'76561197991366250','76561197991462799','76561197991482690','76561197991820443','76561197992226017','76561197993380477',
'76561197994272516','76561197994335988','76561197994551896','76561197995513613','76561197998798101','76561197999028646',
'76561198000417060','76561198000527065','76561198000788033','76561198000935372','76561198000939339','76561198001041505',
'76561198001950895','76561198003869198','76561198005067716','76561198005216338','76561198005682947','76561198005799199',
'76561198006183678','76561198006188915','76561198006333375','76561198008034872','76561198010939093','76561198011773059',
'76561198012175048','76561198012210167','76561198012665504','76561198014231802','76561198014416762','76561198015716842',
'76561199827082250','76561199827164385','76561199827176235',
'76561199827604829','76561199827658378','76561199827689178','76561199827806278','76561199827902536','76561199827934596',
'76561199828013269','76561199828097018','76561199828159940','76561199828204756','76561199828362423','76561199828365924',
'76561199828391936','76561199829218194','76561198368591266','76561197991538216','76561197991895219','76561197992054618',
'76561197992150408','76561197992683765','76561197992697206','76561197993513114','76561197993526322','76561197993757129',
'76561197993920967','76561197994317056','76561197994346355','76561197994588412','76561197994839390','76561197995572259',
'76561197995658698','76561197996250881','76561197997567190','76561197998251925','76561197998933315','76561198000083503',
'76561198000203619','76561198000506156','76561198002238430','76561198002392660','76561198002818111','76561198003276598',
'76561198003411614','76561198004016112','76561198004904822','76561198005781933','76561198006739941','76561198007160390',
'76561198008468326','76561198009238674','76561198010930141',
'76561198011417033','76561198012138443','76561198013081255','76561198015420757','76561198017337417','76561198017879012',
'76561198018044705','76561198020569815','76561199826953831','76561199826984494','76561199827159211','76561199827785929',
'76561199827791971','76561199827822830','76561199827951718','76561199828048510','76561199828051778','76561199828237442',
'76561199828330176','76561197990062414','76561197991616239','76561197992140948','76561197992373185','76561197992815705',
'76561197993568794','76561197994122818','76561197994259784','76561197994295221','76561197994982003','76561197995686069',
'76561197996300939','76561197996389403','76561197996500184','76561197997547084','76561197997553346','76561197997978876',
'76561197998968230','76561197999103454','76561197999525686','76561198000025280','76561198001004622','76561198001828747',
'76561198002175300','76561198003194949','76561198003983827','76561198004026481','76561198004405654','76561198004621347',
'76561198007472070','76561198008644308','76561198009222684',
'76561198009861319','76561198011018297','76561198011955457','76561198012384503','76561198013500686','76561198014570683',
'76561198014773747','76561198014955678','76561198016091765','76561199827401516','76561199827470220','76561199827620793',
'76561199827740301','76561199827830784','76561199828057904','76561199828457319','76561199828724114','76561199585854783',
'76561198317119124','76561197990205142','76561197990391127','76561197992773036','76561197992971230',
'76561197993163624','76561197993290653','76561197993813779','76561197994210559','76561197994581140','76561197997440393',
'76561197998757795','76561197999481561','76561197999493898','76561198000022887','76561198000320943','76561198000872563',
'76561198003338292','76561198003782654','76561198003932740','76561198006461279','76561198007825117','76561198008278377',
'76561198008625641','76561198008777554','76561198009182881','76561198010926843','76561198011285062','76561198011659167',
'76561198012728685','76561198012763243','76561199069468652',
'76561198013390598','76561198015224706','76561198015504004','76561198017694306','76561198023069871','76561198024623330',
'76561199827547167','76561199827713641','76561199827769519','76561199827873526','76561199827896924','76561199827941278',
'76561199828014131','76561199828060963','76561199828080694','76561199828172459','76561199828540768','76561199829032938',
'76561197989342425','76561197990882190','76561197991624439','76561197991866643','76561197992178537','76561197992405499',
'76561197992687309','76561197992792919','76561197994278853','76561197994487545','76561197996353440','76561197996567197',
'76561197997611991','76561197999937281','76561198000034382','76561198000063085','76561198000201847','76561198000219503',
'76561198001623966','76561198002048265','76561198002155821','76561198002264634','76561198003764647','76561198003892678',
'76561198004115146','76561198005347570','76561198005514783','76561198007267280','76561198007674095','76561198008511627',
'76561198009956900','76561198010534897','76561198364990491',
'76561198011814911','76561198011997656','76561198013027221','76561198015616207','76561198016126209','76561198022106292',
'76561199826800369','76561199826934374','76561199827227571','76561199827248309','76561199827294857','76561199827672789',
'76561199827811034','76561199827866016','76561199827999183','76561199828110517','76561199828290553','76561199828718781',
'76561199828988513','76561199829258708','76561197990080680','76561197990349950','76561197991399585','76561197991648345',
'76561197993110938','76561197993657581','76561197993675728','76561197993756941','76561197994375645','76561197994618165',
'76561197995259044','76561197995381132','76561197996077994','76561197996876299','76561197998588282','76561197998963973',
'76561197998975744','76561197999258076','76561197999710432','76561197999883670','76561198000061477','76561198000254183',
'76561198001037845','76561198001552192','76561198002024828','76561198002500778','76561198002540592','76561198002838219',
'76561198003234749','76561198004144198','76561198004571436',
'76561198005157426','76561198005560521','76561198006763203','76561198006978854','76561198008940589','76561198010970178',
'76561198012987519','76561198015242766','76561198015995163','76561198016827085','76561198017220397','76561198017505685',
'76561198017905281','76561198019072781','76561198023517559','76561198023599368','76561199826878782','76561199827481105',
'76561199827494503','76561199827583598','76561199827696526','76561199827827719','76561199827827865','76561199828005087',
'76561199828172402','76561199828172870','76561199828311424','76561199828337385','76561199828562052','76561199828715651',
'76561199828752871','76561197988242132','76561197991540347','76561197992259373','76561197992796883','76561197992946010',
'76561197993140802','76561197993386840','76561197994239588','76561197994456426','76561197994810028','76561197995027060',
'76561197995209203','76561197995230602','76561197995961494','76561197996641451','76561197998257225','76561197998765450',
'76561197998848466','76561197999621427','76561197999836531',
'76561198000623844','76561198000966378','76561198001711092','76561198002279183','76561198003298358','76561198003392187',
'76561198003891226','76561198004179545','76561198004216081','76561198004679778','76561198006263854','76561198007009077',
'76561198008176974','76561198008942149','76561198010049393','76561198010734041','76561198010736312','76561198010966062',
'76561198011199323','76561198011694442','76561198011724883','76561198011775079','76561198012219824','76561198012287464',
'76561198013695128','76561198014280364','76561198014912595','76561198021037766','76561198022234771','76561199826817609',
'76561199827149002','76561199827429912','76561199827554063','76561199827580972','76561199827646498','76561199827734988',
'76561199827763730','76561199827782062','76561199827794275','76561199827803090','76561199827997643','76561199828052841',
'76561199828111039','76561199828252171','76561199828306263','76561199829524781','76561197988732750','76561197989418475',
'76561197990973609','76561197991425297','76561197993111382',
'76561197993261692','76561197993296746','76561197994020840','76561197994575475','76561197995916640','76561197996625572',
'76561197997620135','76561197997750313','76561197997791604','76561197998097430','76561197998735926','76561197998786978',
'76561197998879014','76561197999566012','76561198001067790','76561198001806541','76561198002742000','76561198002897180',
'76561198003097823','76561198004003417','76561198005015588','76561198008246738','76561198009269429','76561198010351288',
'76561198010752682','76561198011644304','76561198012216453','76561198012785635','76561198012877238','76561198014708524',
'76561198015067592','76561198018941720','76561198021488929','76561198023453127','76561198023910420','76561199827237558',
'76561199827438058','76561199827629004','76561199827744413','76561199827775713','76561199827926698','76561199827938280',
'76561199828012838','76561199828418413','76561199828477313','76561199828499924','76561199828824338','76561199829156471',
'76561198402216063',
'76561197992043462','76561197994505368','76561197995767982','76561197998000045','76561197998580821','76561197998712891',
'76561197998766611','76561197999323819','76561197999360353','76561198000712143','76561198001779761','76561198002163667',
'76561198002929320','76561198003109707','76561198004141478','76561198004519584','76561198006940407','76561198007281489',
'76561198008738969','76561198009092463','76561198009847711','76561198010096276','76561198010536954','76561198010575665',
'76561198010811140','76561198011126579','76561198012329500','76561198012847337','76561198014470987','76561198014480706',
'76561198018267497','76561198018356992','76561198021267135','76561198021495430','76561199826937822','76561199827116380',
'76561199827166753','76561199827327426','76561199827420274','76561199827610803','76561199827671824','76561199827751618',
'76561199827891653','76561199828032814','76561199828244732','76561199828259099','76561199828362932','76561199828453438',
'76561199828575522',
'76561197995064032','76561197995950314','76561197996743064','76561198001274083','76561198005637616','76561198009148546',
'76561198018947453','76561197989082198','76561197991689387','76561197992400224','76561197992660999','76561197992707639',
'76561197994440204','76561197994734203','76561197995085700','76561197995172849','76561197998320201','76561198005110200',
'76561198012467242','76561198012612539','76561198010131903','76561197991607046','76561197995442081','76561197987518866',
'76561197990021728','76561197990028358','76561197990179241','76561197991852074','76561197992037323','76561197993360059',
'76561198000927701','76561198005758780','76561197994271445','76561197991025050','76561197992227375','76561197992988333',
'76561197993352387','76561197994548470','76561197994601738','76561197995226285','76561197996792766','76561197998166547',
'76561198000405432','76561198005927558','76561198007540878','76561198014459398','76561198014740440','76561197998408117',
'76561197989794113',
'76561198012708167','76561198000503884','76561198016977982','76561198007723707','76561197995514356','76561199083090638',
'76561197998252748','76561197997355591','76561198011957705','76561197990642234','76561198017787832','76561197999551029',
'76561198260021630','76561198201365290','76561197989893077','76561197990200887','76561197991019242','76561197991788356',
'76561197991853342','76561197992558133','76561197992745164','76561197993214495','76561197993432077','76561197993603578',
'76561197994963076','76561198002331205','76561198005498800','76561198015096406','76561198017114981','76561197991877073',
'76561197992682858','76561197993545907','76561197993758857','76561197994650323','76561198003097051','76561198006108917',
'76561198014757053','76561198005617267','76561198007387065','76561197998985228','76561198005158479','76561197992831930',
'76561197993032098','76561197996165262','76561197996679708','76561198009343207','76561198017993687','76561197989513759',
'76561197991390337',
'76561198006928947','76561198009897959','76561198010344472','76561198011717413','76561197994130372','76561197991066652',
'76561197991773824','76561197992218427','76561197993000045','76561197993076520','76561197994658347','76561197994756925',
'76561197998957454','76561198008819530','76561198015480700','76561197989624045','76561197992230121','76561197992331321',
'76561197993773212','76561197996014153','76561197999317464','76561198001456078','76561198005065242','76561198005865638',
'76561198012802277','76561198004548874','76561197990862515','76561197991182222','76561197992692394','76561197994038435',
'76561197994400608','76561197995143047','76561198000708085','76561198000892053','76561198009289045','76561198016818522',
'76561199827150481','76561197988738448','76561197992535525','76561197993733381','76561197994290197','76561197995190589',
'76561197995260074','76561198002224478','76561198002404097','76561198004266492','76561198011513572','76561197990024635',
'76561197990247111','76561197991588766','76561197994527420',
'76561197998215207','76561198002291356','76561198002526653','76561198002997715','76561198007937450','76561198011125578',
'76561198011297328','76561197994293766','76561198020189504','76561198005023926','76561198015214075','76561198000468197',
'76561197990290974','76561197991287376','76561197993363504','76561197995350794','76561197999045946','76561198001270289',
'76561198010052374','76561198011115961','76561198017134595','76561197988397388','76561197991540924','76561197994710956',
'76561197994808646','76561197999351471','76561198010739061','76561197997392954','76561198000832283','76561197987875286',
'76561197991006717','76561197991864945','76561197994050536','76561197994124737','76561197994827168','76561197998813158',
'76561197999427964','76561198005638391','76561198006228245','76561198009327304','76561198012929722','76561199828754977',
'76561197989945934','76561197991425375','76561197993899404','76561197994651615','76561197997015731','76561197999552731',
'76561198003603722','76561198012558992','76561198015242931',
'76561197990896928','76561197997839800','76561198007957686','76561198008464131','76561198008704102','76561198008915142',
'76561198002851742','76561198007804592','76561198016669897','76561197999668399','76561197988002881','76561197989244527',
'76561197989716470','76561197992023229','76561197992267386','76561197993916350','76561197994750150','76561197994846074',
'76561197994863887','76561198001539859','76561198003467246','76561197988554380','76561197988569909','76561197989329342',
'76561197990670923','76561197991238127','76561197991299937','76561197991622989','76561197992060201','76561197992159292',
'76561197992579565','76561197993904776','76561197994012278','76561197994439563','76561198000370687','76561198001493873',
'76561198003201086','76561198003348639','76561198003409249','76561198004728588','76561198004818926','76561198004821064',
'76561198004994901','76561198005168754','76561198011424566','76561198018524106','76561198011292340','76561198007731950',
'76561197988587747','76561197989323665','76561197991327811',
'76561197992217395','76561197993582003','76561197994485918','76561197994619876','76561197998061915','76561198002009079',
'76561198006461468','76561198011656957','76561198005362001','76561198016315014','76561197987560549','76561197989679813',
'76561197989937372','76561197992341410','76561197992813135','76561197993147439','76561197995036791','76561198001777307',
'76561198006071713','76561198013773597','76561198013904678','76561198015706974','76561198007540230','76561198013359443',
'76561198008288722','76561198014045589','76561198005438045','76561197992429617','76561198003437585','76561198004529643',
'76561198014525865','76561198016295290','76561197991188927','76561197993975308','76561198002476870','76561198007499879',
'76561198016479743','76561198017013822','76561198017776258','76561198018789567','76561198006261750','76561198008300339',
'76561198014945306','76561198000095318','76561198004214617','76561198011790353','76561198011285952','76561198011987455',
'76561198002778790',
    
]
    
    
DATA_FILE = 'friend_data.json'
INIT_FILE = '.initialized'

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger("SteamFriendIDMonitor")

def get_profile_link(steam_id):
    """Generate Steam profile link from Steam ID"""
    return f"steamcommunity.com/profiles/{steam_id}"

async def fetch_friend_list(session, steam_id):
    """Fetch the complete friend list for a Steam account"""
    url = f"http://api.steampowered.com/ISteamUser/GetFriendList/v0001/?key={STEAM_API_KEY}&steamid={steam_id}&relationship=friend"
    profile_link = get_profile_link(steam_id)
    
    try:
        async with session.get(url, timeout=10) as resp:
            if resp.status == 200:
                data = await resp.json()
                friends_data = data.get('friendslist', {}).get('friends', [])
                # Extract just the Steam IDs of friends
                friend_ids = [friend['steamid'] for friend in friends_data]
                return steam_id, profile_link, friend_ids
            elif resp.status == 403:
                logger.warning(f"{profile_link} is private")
                return steam_id, profile_link, None
            else:
                logger.error(f"{profile_link}: API error {resp.status}")
                return steam_id, profile_link, None
    except Exception as e:
        logger.error(f"Error fetching {profile_link}: {e}")
        return steam_id, profile_link, None

async def send_telegram_message(message):
    """Send message to Telegram, splitting if too long"""
    MAX_MESSAGE_LENGTH = 4000  # Leave some buffer under 4096 limit
    
    if len(message) <= MAX_MESSAGE_LENGTH:
        await _send_single_message(message)
    else:
        # Split message into chunks
        lines = message.split('\n')
        current_chunk = ""
        
        for line in lines:
            # If adding this line would exceed limit, send current chunk
            if len(current_chunk + line + '\n') > MAX_MESSAGE_LENGTH:
                if current_chunk:
                    await _send_single_message(current_chunk.strip())
                    current_chunk = line + '\n'
                else:
                    # Single line is too long, truncate it
                    await _send_single_message(line[:MAX_MESSAGE_LENGTH])
            else:
                current_chunk += line + '\n'
        
        # Send remaining chunk
        if current_chunk:
            await _send_single_message(current_chunk.strip())

async def _send_single_message(message):
    """Send a single message to Telegram"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': message,
        'parse_mode': 'HTML'
    }
    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(url, data=payload) as resp:
                if resp.status != 200:
                    logger.error(f"Failed to send message: {await resp.text()}")
                else:
                    logger.info("Telegram message sent successfully")
        except Exception as e:
            logger.error(f"Telegram error: {e}")

def load_previous_data():
    """Load previous friend data from file"""
    try:
        with open(DATA_FILE, 'r') as f:
            return json.load(f)
    except:
        return {}

def save_data(data):
    """Save friend data to file"""
    with open(DATA_FILE, 'w') as f:
        json.dump(data, f, indent=2)

def is_first_run():
    """Check if this is the first run of the bot"""
    if os.path.exists(INIT_FILE):
        return False
    with open(INIT_FILE, 'w') as f:
        f.write(datetime.now().isoformat())
    return True

async def check_accounts():
    """Main function to check all accounts for friend changes"""
    first_run = is_first_run()
    previous_data = load_previous_data()
    current_data = {}
    all_new_friends = []
    
    async with aiohttp.ClientSession() as session:
        results = []
        BATCH_SIZE = 500  # Process 100 accounts at a time
        DELAY_BETWEEN_BATCHES = 5  # Wait 5 seconds between batches
        
        for i in range(0, len(STEAM_ACCOUNTS), BATCH_SIZE):
            batch = STEAM_ACCOUNTS[i:i + BATCH_SIZE]
            tasks = [fetch_friend_list(session, steam_id) for steam_id in batch]
            batch_results = await asyncio.gather(*tasks)
            results.extend(batch_results)
            
            # Don't delay after the last batch
            if i + BATCH_SIZE < len(STEAM_ACCOUNTS):
                logger.info(f"Processed {i + BATCH_SIZE}/{len(STEAM_ACCOUNTS)} accounts, waiting {DELAY_BETWEEN_BATCHES}s...")
                await asyncio.sleep(DELAY_BETWEEN_BATCHES)
    
    for steam_id, profile_link, friend_ids in results:
        if friend_ids is None:
            continue
            
        current_data[steam_id] = {
            'profile_link': profile_link,
            'friends': friend_ids,
            'count': len(friend_ids)
        }
        
        # Skip change detection on first run
        if first_run or steam_id not in previous_data:
            continue
            
        previous_friends = set(previous_data[steam_id].get('friends', []))
        current_friends = set(friend_ids)
        
        # Check for new friends only
        new_friends = current_friends - previous_friends
        if new_friends:
            for friend_id in new_friends:
                friend_profile_link = get_profile_link(friend_id)
                all_new_friends.append(friend_profile_link)
                logger.info(f"New friend detected: {friend_id} added to {steam_id}")
        
        # Log removed friends (no telegram notification)
        removed_friends = previous_friends - current_friends
        if removed_friends:
            for friend_id in removed_friends:
                logger.info(f"Friend removed: {friend_id} removed from {steam_id}")

    # Send batched notification for all new friends
    logger.info(f"Total new friends collected: {len(all_new_friends)}")
    logger.info(f"First run status: {first_run}")
    
    if all_new_friends and not first_run:
        if len(all_new_friends) == 1:
            msg = f"New friend: {all_new_friends[0]}"
        else:
            msg = f"New friends detected ({len(all_new_friends)}):\n\n"
            msg += "\n".join([f"• {friend_link}" for friend_link in all_new_friends])
        
        logger.info(f"Attempting to send Telegram message: {msg[:100]}...")
        await send_telegram_message(msg)
        logger.info(f"Sent batched notification for {len(all_new_friends)} new friends")
    elif all_new_friends and first_run:
        logger.info(f"New friends detected on first run (not sending notification): {len(all_new_friends)}")
    else:
        logger.info("No new friends detected in this cycle")

    # Save current data
    save_data(current_data)

    if first_run:
        # Log initial setup (no telegram messages)
        total_accounts = len(current_data)
        private_accounts = len(STEAM_ACCOUNTS) - total_accounts
        total_friends = sum(data['count'] for data in current_data.values())
        
        logger.info(f"Steam Friend ID Monitor Setup Complete")
        logger.info(f"Monitoring {total_accounts} accounts")
        logger.info(f"Total friends being tracked: {total_friends}")
        if private_accounts > 0:
            logger.info(f"{private_accounts} accounts are private")
        logger.info("Bot will now notify when specific friends are added with their Steam IDs")
    else:
        logger.info("Friend check completed")

if __name__ == '__main__':
    asyncio.run(check_accounts())
